
<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ·˜å®å¹¿å‘Šç‚¹å‡»é‡å¤§æ•°æ®åˆ†æç³»ç»Ÿ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
    }

    body {
      background-color: #0f1a2f;
      display: flex;
      height: 100vh;
      overflow: hidden;
      color: #fff;
    }

    /* ä¾§è¾¹å¯¼èˆªæ  */
    .sidebar {
      width: 200px;
      background-color: #1a243f;
      color: #fff;
      display: flex;
      flex-direction: column;
      height: 100%;
      padding-top: 20px;
      transition: width 0.3s ease;
      border-right: 1px solid #2a3655;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 0 20px 20px;
      border-bottom: 1px solid #2a3655;
    }

    .sidebar-header i {
      font-size: 24px;
      color: #00a1ff;
    }

    .sidebar-header h2 {
      font-size: 16px;
      font-weight: 600;
      color: #00a1ff;
    }

    .sidebar-menu {
      flex: 1;
      padding: 20px 0;
    }

    .menu-item {
      padding: 12px 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
      text-decoration: none;
      color: #b8c2d9;
      display: block;
      border-left: 3px solid transparent;
      position: relative;
    }

    /* æŠ˜å èœå•çš„ç®­å¤´æ ·å¼ */
    .menu-item.has-submenu::after {
      content: "\f078";
      font-family: "Font Awesome 6 Free";
      font-weight: 900;
      font-size: 10px;
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      transition: transform 0.3s ease;
      color: #b8c2d9;
    }

    .menu-item.has-submenu.collapsed::after {
      transform: translateY(-50%) rotate(-90deg);
    }

    .menu-item.active {
      background-color: rgba(0, 161, 255, 0.1);
      color: #00a1ff;
      border-left-color: #00a1ff;
    }

    .menu-item:hover:not(.active) {
      background-color: rgba(255, 255, 255, 0.05);
      color: #fff;
    }

    .menu-item i {
      width: 18px;
      text-align: center;
    }

    .submenu {
      padding-left: 40px;
      background-color: #151e35;
      display: none; /* é»˜è®¤éšè— */
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .submenu.show {
      display: block;
      max-height: 500px; /* è¶³å¤Ÿå¤§çš„é«˜åº¦å®¹çº³å­èœå• */
    }

    .submenu .menu-item {
      padding: 10px 20px;
      font-size: 13px;
    }

    /* ä¸»å†…å®¹åŒº */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      height: 100%;
      overflow-y: auto;
      transition: margin-left 0.3s ease;
    }

    /* é¡¶éƒ¨å¯¼èˆªæ  */
    .topbar {
      height: 60px;
      background-color: #1a243f;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      border-bottom: 1px solid #2a3655;
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .topbar-menu-btn {
      font-size: 18px;
      cursor: pointer;
      color: #b8c2d9;
    }

    .topbar-title {
      font-size: 18px;
      font-weight: 600;
      color: #00a1ff;
    }

    /* æ¬¢è¿æ  */
    .welcome-bar {
      background: linear-gradient(135deg, #0f1a2f 0%, #1a2b4f 100%);
      color: #fff;
      padding: 30px 40px;
      margin: 20px;
      border-radius: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid #2a3655;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .welcome-info {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .welcome-avatar {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      background: linear-gradient(135deg, #00a1ff 0%, #0080ff 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      box-shadow: 0 5px 15px rgba(0, 161, 255, 0.3);
    }

    .welcome-text h3 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 10px;
      background: linear-gradient(90deg, #00a1ff, #00ffaa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .welcome-text p {
      font-size: 16px;
      color: #b8c2d9;
      line-height: 1.6;
    }

    .welcome-time {
      text-align: right;
      background: rgba(0, 0, 0, 0.2);
      padding: 15px 25px;
      border-radius: 8px;
      border: 1px solid #2a3655;
    }

    .time-clock {
      font-size: 28px;
      font-weight: 600;
      margin-bottom: 5px;
      color: #00ffaa;
      font-family: 'Courier New', monospace;
    }

    .time-date {
      font-size: 16px;
      color: #b8c2d9;
    }

    /* æ•°æ®å¡ç‰‡åŒº */
    .data-cards {
      padding: 0 20px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }

    .data-card {
      background: linear-gradient(135deg, #1a243f 0%, #223056 100%);
      border-radius: 12px;
      padding: 25px 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid #2a3655;
    }

    .data-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 161, 255, 0.2);
      border-color: #00a1ff;
    }

    .card-icon {
      width: 50px;
      height: 50px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: #fff;
    }

    .icon-purple {
      background: linear-gradient(135deg, #9c27b0 0%, #673ab7 100%);
    }

    .icon-pink {
      background: linear-gradient(135deg, #e91e63 0%, #c2185b 100%);
    }

    .icon-blue {
      background: linear-gradient(135deg, #2196f3 0%, #0d47a1 100%);
    }

    .icon-green {
      background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
    }

    .icon-orange {
      background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
    }

    .icon-teal {
      background: linear-gradient(135deg, #009688 0%, #00695c 100%);
    }

    .card-data h4 {
      font-size: 28px;
      font-weight: 700;
      color: #fff;
      margin-bottom: 5px;
    }

    .card-data p {
      font-size: 14px;
      color: #b8c2d9;
    }

    /* å¤§å±å±•ç¤ºåŒº */
    .dashboard-area {
      padding: 0 20px 30px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .dashboard-card {
      background: linear-gradient(135deg, #1a243f 0%, #223056 100%);
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      border: 1px solid #2a3655;
      transition: all 0.3s ease;
    }

    .dashboard-card:hover {
      box-shadow: 0 15px 35px rgba(0, 161, 255, 0.15);
    }

    .dashboard-title {
      font-size: 18px;
      font-weight: 600;
      color: #00a1ff;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #2a3655;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .dashboard-title i {
      font-size: 20px;
    }

    .chart-container {
      height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      width: 100%;
    }

    /* åŠ è½½ä¸­æ ·å¼ */
    .loading {
      text-align: center;
      color: #b8c2d9;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .loading i {
      font-size: 40px;
      margin-bottom: 15px;
      color: #00a1ff;
      animation: spin 1.5s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* å†…å®¹å®¹å™¨ */
    .content-wrapper {
      flex: 1;
      overflow-y: auto;
      padding-bottom: 20px;
    }

    /* å…¶ä»–é¡µé¢æ ·å¼ */
    .page-content {
      padding: 30px;
      width: 100%;
    }

    .page-title {
      font-size: 28px;
      font-weight: 600;
      margin-bottom: 20px;
      color: #00a1ff;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .page-desc {
      font-size: 16px;
      color: #b8c2d9;
      margin-bottom: 30px;
      line-height: 1.8;
      background: rgba(0, 0, 0, 0.2);
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #2a3655;
    }

    /* è¯¦æƒ…é¡µé¢æ ·å¼ */
    .detail-section {
      background: linear-gradient(135deg, #1a243f 0%, #223056 100%);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
      border: 1px solid #2a3655;
    }

    .detail-title {
      font-size: 20px;
      font-weight: 600;
      color: #00ffaa;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #2a3655;
    }

    .detail-content {
      color: #b8c2d9;
      line-height: 1.8;
    }

    .detail-item {
      margin-bottom: 15px;
      padding: 10px;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 6px;
    }

    .detail-item strong {
      color: #00a1ff;
      margin-right: 10px;
    }

    /* å›¾è¡¨å®¹å™¨å¼ºåˆ¶æ ·å¼ */
    .chart-placeholder {
      width: 100% !important;
      height: 400px !important;
      min-height: 400px !important;
    }

    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 1200px) {
      .data-cards {
        grid-template-columns: repeat(2, 1fr);
      }

      .dashboard-area {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .data-cards {
        grid-template-columns: 1fr;
      }

      .welcome-bar {
        flex-direction: column;
        gap: 20px;
        text-align: center;
      }

      .welcome-time {
        text-align: center;
      }
    }
  </style>
  <!-- å¼•å…¥å›¾æ ‡åº“ -->
  <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- æ”¹ç”¨ç¨³å®šCDNå¼•å…¥ECharts -->
  <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
</head>

<body>
  <!-- ä¾§è¾¹å¯¼èˆªæ  -->
  <div class="sidebar">
    <div class="sidebar-header">
      <i class="fas fa-chart-line"></i>
      <h2>å¹¿å‘Šæ•°æ®åˆ†æ</h2>
    </div>
    <div class="sidebar-menu">
      <!-- ç³»ç»Ÿé¦–é¡µ -->
      <div class="menu-item" data-route="/index">
        <i class="fas fa-home"></i>
        <span>ç³»ç»Ÿé¦–é¡µ</span>
      </div>
      <!-- éœ€æ±‚1ï¼šå¹¿å‘Šç‚¹å‡»ç‡éšæ—¶é—´å˜åŒ–è¶‹åŠ¿åˆ†æ -->
      <div class="menu-item" data-route="/requirement1">
        <i class="fas fa-clock"></i>
        <span>ç‚¹å‡»ç‡æ—¶é—´è¶‹åŠ¿</span>
      </div>
      <!-- éœ€æ±‚2ï¼šç”¨æˆ·ç‚¹å‡»è¡Œä¸ºåˆ†å¸ƒåˆ†æ -->
      <div class="menu-item" data-route="/requirement2">
        <i class="fas fa-chart-pie"></i>
        <span>ç”¨æˆ·è¡Œä¸ºåˆ†å¸ƒ</span>
      </div>
      <!-- éœ€æ±‚3ï¼šç”¨æˆ·æ¶ˆè´¹æ¡£æ¬¡ä¸ç‚¹å‡»ç‡å…³ç³»åˆ†æï¼ˆå¯æŠ˜å ï¼‰ -->
      <div class="menu-item has-submenu" id="consumptionParent">
        <i class="fas fa-money-bill-wave"></i>
        <span>æ¶ˆè´¹æ¡£æ¬¡åˆ†æ</span>
      </div>
      <!-- æ–°å¢ï¼šæ¶ˆè´¹æ¡£æ¬¡å­èœå•ï¼ˆåŒ…å«è½¬åŒ–ç‡ï¼‰ -->
      <div class="submenu" id="consumptionSubmenu">
        <div class="menu-item" data-route="/consumption/level">
          <i class="fas fa-list"></i>
          <span>æ¶ˆè´¹æ¡£æ¬¡-ç‚¹å‡»åˆ†æ</span>
        </div>

      </div>
      <!-- éœ€æ±‚4ï¼šä¸åŒåŸå¸‚å±‚çº§å¹¿å‘Šç‚¹å‡»åå¥½åˆ†æ -->
      <div class="menu-item" data-route="/requirement4">
        <i class="fas fa-city"></i>
        <span>åŸå¸‚å±‚çº§åå¥½</span>
      </div>
      <!-- éœ€æ±‚5ï¼šè´­ç‰©æ·±åº¦ç”¨æˆ·ä»·å€¼åˆ†æï¼ˆå¯æŠ˜å ï¼‰ -->
      <div class="menu-item has-submenu" id="shoppingLevelParent">
        <i class="fas fa-shopping-cart"></i>
        <span>è´­ç‰©æ·±åº¦åˆ†æ</span>
      </div>
      <!-- è´­ç‰©æ·±åº¦å­èœå•ï¼ˆç§»é™¤è½¬åŒ–ç‡ï¼‰ -->
      <div class="submenu" id="shoppingLevelSubmenu">
        <div class="menu-item" data-route="/shoppingLevel/behavior">
          <i class="fas fa-list"></i>
          <span>è´­ç‰©æ·±åº¦-è¡Œä¸ºåˆ†å¸ƒ</span>
        </div>
        <div class="menu-item" data-route="/shoppingLevel/trend">
          <i class="fas fa-chart-line"></i>
          <span>è´­ç‰©æ·±åº¦-æ—¶é—´è¶‹åŠ¿</span>
        </div>
      </div>
      <!-- è¯¦æƒ…åˆ†æ -->
      <div class="menu-item" data-route="/detail">
        <i class="fas fa-info-circle"></i>
        <span>è¯¦æƒ…åˆ†æ</span>
      </div>
    </div>
  </div>

  <!-- ä¸»å†…å®¹åŒº -->
  <div class="main-content">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <div class="topbar">
      <div class="topbar-left">
        <div class="topbar-menu-btn" id="sidebarToggle">
          <i class="fas fa-bars"></i>
        </div>
        <div class="topbar-title" id="currentPageTitle">æ·˜å®å¹¿å‘Šç‚¹å‡»é‡å¤§æ•°æ®åˆ†æ</div>
      </div>
    </div>

    <!-- å†…å®¹å®¹å™¨ -->
    <div class="content-wrapper" id="contentWrapper">
      <!-- åˆå§‹å†…å®¹ï¼šç³»ç»Ÿé¦–é¡µ -->
      <div class="welcome-bar">
        <div class="welcome-info">
          <div class="welcome-avatar">
            <i class="fas fa-chart-bar"></i>
          </div>
          <div class="welcome-text">
            <h3>æ·˜å®å¹¿å‘Šç‚¹å‡»é‡å¤§æ•°æ®åˆ†æç³»ç»Ÿ</h3>
            <p>å®æ—¶ç›‘æ§æ·˜å®å¹¿å‘Šç‚¹å‡»æ•°æ®ï¼Œæ·±åº¦åˆ†æç”¨æˆ·è¡Œä¸ºæ¨¡å¼<br>
              åŸºäºå¤§æ•°æ®æŠ€æœ¯å®ç°ç²¾å‡†è¥é”€å†³ç­–æ”¯æŒ<br>
              <span style="font-size: 14px; color: #00ffaa;">æ•°æ®æ¥æºï¼šæ·˜å®å¹¿å‘Šç³»ç»Ÿ | æ›´æ–°æ—¶é—´ï¼šå®æ—¶</span>
            </p>
          </div>
        </div>
        <div class="welcome-time">
          <div class="time-clock">00:34:05</div>
          <div class="time-date">2025å¹´12æœˆ5æ—¥ æ˜ŸæœŸäº”</div>
          <div class="time-weather">ğŸ“Š æ•°æ®è¿è¡Œæ­£å¸¸</div>
        </div>
      </div>

      <div class="data-cards">
        <div class="data-card" data-route="/requirement1">
          <div class="card-icon icon-purple">
            <i class="fas fa-clock"></i>
          </div>
          <div class="card-data">
            <h4>2.34%</h4>
            <p>å¹³å‡ç‚¹å‡»ç‡</p>
          </div>
        </div>
        <div class="data-card" data-route="/requirement2">
          <div class="card-icon icon-pink">
            <i class="fas fa-mouse-pointer"></i>
          </div>
          <div class="card-data">
            <h4>8.7M</h4>
            <p>æ—¥ç‚¹å‡»é‡</p>
          </div>
        </div>
        <div class="data-card" data-route="/requirement3">
          <div class="card-icon icon-blue">
            <i class="fas fa-users"></i>
          </div>
          <div class="card-data">
            <h4>156K</h4>
            <p>æ´»è·ƒç”¨æˆ·æ•°</p>
          </div>
        </div>
        <div class="data-card" data-route="/requirement4">
          <div class="card-icon icon-green">
            <i class="fas fa-map-marker-alt"></i>
          </div>
          <div class="card-data">
            <h4>32</h4>
            <p>è¦†ç›–åŸå¸‚æ•°</p>
          </div>
        </div>
      </div>

      <!-- å¤§å±å±•ç¤ºåŒº -->
      <div class="dashboard-area">
        <div class="dashboard-card">
          <div class="dashboard-title">
            <i class="fas fa-chart-line"></i>
            <span>å®æ—¶ç‚¹å‡»è¶‹åŠ¿ç›‘æ§</span>
          </div>
          <div class="chart-container">
            <div style="text-align: center; color: #b8c2d9;">
              <i class="fas fa-chart-line" style="font-size: 60px; margin-bottom: 20px; color: #00a1ff;"></i>
              <p>å®æ—¶æ•°æ®å¯è§†åŒ–å±•ç¤º</p>
              <p style="font-size: 14px; margin-top: 10px;">æ¯å°æ—¶æ›´æ–°ä¸€æ¬¡</p>
            </div>
          </div>
        </div>

        <div class="dashboard-card">
          <div class="dashboard-title">
            <i class="fas fa-chart-pie"></i>
            <span>ç”¨æˆ·è¡Œä¸ºåˆ†å¸ƒ</span>
          </div>
          <div class="chart-container">
            <div style="text-align: center; color: #b8c2d9;">
              <i class="fas fa-pie-chart" style="font-size: 60px; margin-bottom: 20px; color: #00ffaa;"></i>
              <p>ç‚¹å‡»/æœªç‚¹å‡»åˆ†å¸ƒæ¯”ä¾‹</p>
              <p style="font-size: 14px; margin-top: 10px;">å®æ—¶ç»Ÿè®¡æ•°æ®</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ========== æ ¸å¿ƒä¿®å¤1ï¼šæ—¶é—´æ›´æ–°å‡½æ•°å¢å¼º ==========
    function updateTime() {
      const now = new Date();
      const hours = now.getHours().toString().padStart(2, '0');
      const minutes = now.getMinutes().toString().padStart(2, '0');
      const seconds = now.getSeconds().toString().padStart(2, '0');

      // ä¸¥æ ¼æ ¡éªŒDOMå…ƒç´ å­˜åœ¨æ€§
      const timeClock = document.querySelector('.time-clock');
      if (timeClock) {
        timeClock.textContent = `${hours}:${minutes}:${seconds}`;
      }

      // æ›´æ–°æ—¥æœŸ
      const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
      const dateStr = now.toLocaleDateString('zh-CN', options);
      const timeDate = document.querySelector('.time-date');
      if (timeDate) {
        timeDate.textContent = dateStr;
      }
    }
    updateTime();
    setInterval(updateTime, 1000);

    // ========== æ ¸å¿ƒä¿®å¤2ï¼šæ¥å£è¯·æ±‚ä¸æ¨¡æ‹Ÿæ•°æ®ä¼˜åŒ– ==========
    // æ¥å£åŸºç¡€åœ°å€ï¼ˆè¯·æ›¿æ¢ä¸ºä½ çš„çœŸå®åç«¯æ¥å£åœ°å€ï¼‰
    const API_BASE_URL = 'http://localhost:5000/api';

    // é€šç”¨æ¥å£è¯·æ±‚å‡½æ•°ï¼ˆå¢åŠ è¶…æ—¶å’Œé”™è¯¯å…œåº•ï¼‰
    async function fetchApiData(url, method = 'GET', data = {}) {
      try {
        // è®¾ç½®è¯·æ±‚è¶…æ—¶
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 5000);

        const options = {
          method: method,
          headers: {
            'Content-Type': 'application/json'
          },
          signal: controller.signal
        };

        if (method !== 'GET') {
          options.body = JSON.stringify(data);
        }

        const response = await fetch(`${API_BASE_URL}${url}`, options);
        clearTimeout(timeoutId);

        if (!response.ok) {
          throw new Error(`æ¥å£è¯·æ±‚å¤±è´¥ï¼š${response.status}`);
        }

        const result = await response.json();
        return result.code === 200 ? result.data : getMockData(url);
      } catch (error) {
        console.warn('æ¥å£è¯·æ±‚å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼š', error.message);
        return getMockData(url);
      }
    }

    // æ¨¡æ‹Ÿæ•°æ®ï¼ˆå¢å¼ºæ•°æ®å®Œæ•´æ€§ï¼‰
    function getMockData(url) {
      switch(url) {
        case '/requirement1/trend':
          return {
            xAxis: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '23:00'],
            series: [
              { name: 'ç‚¹å‡»ç‡', data: [1.8, 1.2, 2.1, 2.8, 2.9, 2.5, 2.0] }
            ]
          };
        case '/requirement2/distribution':
          return {
            categories: ['ç‚¹å‡»', 'æœªç‚¹å‡»'],
            data: [
              { value: 2.34, name: 'ç‚¹å‡»' },
              { value: 97.66, name: 'æœªç‚¹å‡»' }
            ]
          };
        case '/requirement2/behavior':
          return {
            xAxis: ['æµè§ˆ', 'ç‚¹å‡»', 'åŠ è´­', 'è´­ä¹°'],
            series: [
              { name: 'è¡Œä¸ºæ¬¡æ•°', data: [12000, 2800, 1500, 800] }
            ]
          };
        case '/requirement4/city':
          return {
            xAxis: ['ä¸€çº¿åŸå¸‚', 'äºŒçº¿åŸå¸‚', 'ä¸‰çº¿åŸå¸‚', 'å››çº¿åŠä»¥ä¸‹'],
            series: [
              { name: 'ç‚¹å‡»ç‡', data: [3.2, 2.8, 2.1, 1.5] }
            ]
          };
        case '/consumption/level':
          return {
            xAxis: ['ä½æ¶ˆè´¹', 'ä¸­æ¶ˆè´¹', 'é«˜æ¶ˆè´¹'],
            series: [
              { name: 'ç‚¹å‡»ç‡', data: [1.2, 2.1, 3.5] }
            ]
          };

        case '/shoppingLevel/behavior':
          return {
            xAxis: ['è´­ç‰©æ·±åº¦1', 'è´­ç‰©æ·±åº¦2', 'è´­ç‰©æ·±åº¦3'],
            series: [
              { name: 'æµè§ˆ(pv)', data: [12000, 8500, 6000] },
              { name: 'æ”¶è—(fav)', data: [2500, 3200, 4500] },
              { name: 'åŠ è´­(cart)', data: [1800, 2800, 4200] },
              { name: 'è´­ä¹°(buy)', data: [800, 1500, 3000] }
            ]
          };
        case '/shoppingLevel/trend':
          return {
            xAxis: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
            series: [
              { name: 'è´­ç‰©æ·±åº¦1', data: [350, 280, 800, 1200, 1500, 900] },
              { name: 'è´­ç‰©æ·±åº¦2', data: [420, 350, 950, 1500, 1800, 1100] },
              { name: 'è´­ç‰©æ·±åº¦3', data: [580, 480, 1200, 2000, 2500, 1800] }
            ]
          };
        default:
          return {};
      }
    }

    // ========== æ ¸å¿ƒä¿®å¤3ï¼šå›¾è¡¨æ¸²æŸ“å‡½æ•°é‡æ„ ==========
    // é€šç”¨å›¾è¡¨åˆå§‹åŒ–å‡½æ•°
    function initChart(chartId) {
      const chartDom = document.getElementById(chartId);
      if (!chartDom) {
        console.error(`å›¾è¡¨å®¹å™¨ä¸å­˜åœ¨ï¼š${chartId}`);
        return null;
      }
      // å¼ºåˆ¶è®¾ç½®å®¹å™¨å°ºå¯¸
      chartDom.style.width = '100%';
      chartDom.style.height = '400px';
      return echarts.init(chartDom);
    }

    // æ¸²æŸ“ç‚¹å‡»ç‡æ—¶é—´è¶‹åŠ¿å›¾
    async function renderTimeTrendChart() {
      const chartContainer = document.querySelector('#timeTrendChart');
      if (!chartContainer) return;

      const loadingDiv = chartContainer.parentElement;
      loadingDiv.innerHTML = '<div id="timeTrendChartInner" class="chart-placeholder"></div>';

      try {
        const trendData = await fetchApiData('/hour_click_rate');
        const chartDom = document.getElementById('timeTrendChartInner');
        if (!chartDom) return;

        const myChart = echarts.init(chartDom);

        const option = {
          backgroundColor: 'transparent',
          tooltip: {
            trigger: 'axis',
            formatter: '{b}<br/>ç‚¹å‡»ç‡: {c}%',
            textStyle: { color: '#fff' }
          },
          grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
          },
          xAxis: {
            type: 'category',
            data: trendData.xAxis,
            axisLine: { lineStyle: { color: '#2a3655' } },
            axisLabel: { color: '#b8c2d9' }
          },
          yAxis: {
            type: 'value',
            name: 'ç‚¹å‡»ç‡ (%)',
            axisLine: { lineStyle: { color: '#2a3655' } },
            axisLabel: { color: '#b8c2d9', formatter: '{value}%' },
            splitLine: { lineStyle: { color: 'rgba(42, 54, 85, 0.3)' } }
          },
          series: [
            {
              name: 'ç‚¹å‡»ç‡',
              type: 'line',
              data: trendData.series[0].data,
              smooth: true,
              lineStyle: {
                width: 4,
                color: new echarts.graphic.LinearGradient(0, 0, 1, 0, [
                  { offset: 0, color: '#9c27b0' },
                  { offset: 1, color: '#2196f3' }
                ])
              },
              itemStyle: { color: '#9c27b0' },
              areaStyle: {
                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                  { offset: 0, color: 'rgba(156, 39, 176, 0.3)' },
                  { offset: 1, color: 'rgba(156, 39, 176, 0.1)' }
                ])
              },
              symbol: 'circle',
              symbolSize: 8
            }
          ]
        };

        myChart.setOption(option);
        window.addEventListener('resize', () => myChart.resize());
      } catch (e) {
        console.error('æ¸²æŸ“æ—¶é—´è¶‹åŠ¿å›¾è¡¨å¤±è´¥ï¼š', e);
        loadingDiv.innerHTML = `
          <div class="loading" style="color: #ff4444;">
            <i class="fas fa-exclamation-circle"></i>
            <p>å›¾è¡¨åŠ è½½å¤±è´¥</p>
          </div>
        `;
      }
    }

    // æ¸²æŸ“ç”¨æˆ·è¡Œä¸ºåˆ†å¸ƒé¥¼å›¾
    async function renderBehaviorPieChart() {
      const chartContainer = document.querySelector('#behaviorPieChart');
      if (!chartContainer) return;

      const loadingDiv = chartContainer.parentElement;
      loadingDiv.innerHTML = '<div id="behaviorPieChartInner" class="chart-placeholder"></div>';

      try {
        const distributionData = await fetchApiData('/requirement2/distribution');
        const chartDom = document.getElementById('behaviorPieChartInner');
        if (!chartDom) return;

        const myChart = echarts.init(chartDom);

        const option = {
          backgroundColor: 'transparent',
          tooltip: {
            trigger: 'item',
            formatter: '{a} <br/>{b}: {c}%',
            textStyle: { color: '#fff' }
          },
          legend: {
            orient: 'vertical',
            left: 'left',
            textStyle: { color: '#b8c2d9' }
          },
          series: [
            {
              name: 'è¡Œä¸ºåˆ†å¸ƒ',
              type: 'pie',
              radius: '70%',
              data: distributionData.data,
              label: {
                color: '#b8c2d9',
                formatter: '{b}: {d}%'
              },
              itemStyle: {
                borderRadius: 5,
                borderColor: '#0f1a2f',
                borderWidth: 2
              },
              emphasis: {
                itemStyle: {
                  shadowBlur: 10,
                  shadowOffsetX: 0,
                  shadowColor: 'rgba(0, 0, 0, 0.5)'
                }
              },
              color: ['#e91e63', '#673ab7']
            }
          ]
        };

        myChart.setOption(option);
        window.addEventListener('resize', () => myChart.resize());
      } catch (e) {
        console.error('æ¸²æŸ“è¡Œä¸ºåˆ†å¸ƒé¥¼å›¾å¤±è´¥ï¼š', e);
        loadingDiv.innerHTML = `
          <div class="loading" style="color: #ff4444;">
            <i class="fas fa-exclamation-circle"></i>
            <p>å›¾è¡¨åŠ è½½å¤±è´¥</p>
          </div>
        `;
      }
    }

    // æ¸²æŸ“ç”¨æˆ·è¡Œä¸ºæŸ±çŠ¶å›¾
async function renderBehaviorBarChart() {
  const chartContainer = document.querySelector('#behaviorBarChart');
  if (!chartContainer) {
    console.warn('å›¾è¡¨å®¹å™¨#behaviorBarChartä¸å­˜åœ¨');
    return;
  }

  const loadingDiv = chartContainer.parentElement;
  // å¼ºåˆ¶è®¾ç½®å®¹å™¨å®½é«˜ï¼Œé¿å…å°ºå¯¸å¼‚å¸¸
  loadingDiv.innerHTML = '<div id="behaviorBarChartInner" class="chart-placeholder" style="width: 100%; height: 400px;"></div>';

  try {
    // ä¿æŒåŸè¯·æ±‚åœ°å€ä¸å˜
    const behaviorData = await fetchApiData('/pidclkany');
    console.log('æ¥å£è¿”å›æ•°æ®ï¼š', behaviorData);

    // æ ¡éªŒæ•°æ®ç»“æ„ï¼ˆé€‚é…æ–°æ ¼å¼ï¼‰
    if (!behaviorData || !Array.isArray(behaviorData.xAxis) || !Array.isArray(behaviorData.series)) {
      throw new Error('æ¥å£è¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸ï¼Œç¼ºå°‘xAxisæˆ–serieså­—æ®µ');
    }
    // æ ¡éªŒseriesæ•°æ®æœ‰æ•ˆæ€§
    const seriesItem = behaviorData.series[0];
    if (!seriesItem || !Array.isArray(seriesItem.data)) {
      throw new Error('seriesæ•°æ®æ ¼å¼é”™è¯¯ï¼Œæ— æœ‰æ•ˆæ•°æ®');
    }
    // æ ¡éªŒxAxiså’Œdataé•¿åº¦åŒ¹é…
    if (behaviorData.xAxis.length !== seriesItem.data.length) {
      throw new Error('Xè½´æ•°æ®ä¸ç³»åˆ—æ•°æ®é•¿åº¦ä¸åŒ¹é…');
    }

    // ç­‰å¾…DOMæ¸²æŸ“å®Œæˆ
    await new Promise(resolve => setTimeout(resolve, 0));
    const chartDom = document.getElementById('behaviorBarChartInner');
    if (!chartDom) {
      throw new Error('å›¾è¡¨å†…å±‚å®¹å™¨#behaviorBarChartInnerä¸å­˜åœ¨');
    }

    // æ ¡éªŒEChartsæ˜¯å¦åŠ è½½
    if (typeof echarts === 'undefined') {
      throw new Error('EChartsåº“æœªæ­£ç¡®å¼•å…¥ï¼Œè¯·æ£€æŸ¥CDNæˆ–æœ¬åœ°å¼•å…¥');
    }
    const myChart = echarts.init(chartDom);

    // EChartsé…ç½®é¡¹ï¼ˆé€‚é…æ–°æ•°æ®æ ¼å¼ï¼‰
    const option = {
      backgroundColor: 'transparent',
      tooltip: {
        trigger: 'axis',
        axisPointer: { type: 'shadow' },
        textStyle: { color: '#fff', fontSize: 12 },
        backgroundColor: 'rgba(0, 0, 0, 0.8)',
        borderColor: '#2a3655',
        borderWidth: 1,
        padding: [8, 12],
        formatter: (params) => `${params[0].axisValue}ï¼š<strong>${params[0].value.toFixed(2)}%</strong>`
      },
      grid: {
        left: '3%',
        right: '4%',
        bottom: '3%',
        top: '8%',
        containLabel: true
      },
      xAxis: {
        type: 'category',
        data: behaviorData.xAxis, // ç›´æ¥ä½¿ç”¨åç«¯è¿”å›çš„xAxis
        axisLine: { lineStyle: { color: '#2a3655', width: 1.2 } },
        axisLabel: { color: '#b8c2d9', fontSize: 11 },
        axisTick: { length: 6 },
        boundaryGap: [0.1, 0.2]
      },
      yAxis: {
        type: 'value',
        name: 'ç‚¹å‡»ç‡ (%)',
        nameTextStyle: { color: '#b8c2d9', fontSize: 11 },
        axisLine: { lineStyle: { color: '#2a3655', width: 1.2 } },
        axisLabel: {
          color: '#b8c2d9',
          fontSize: 11,
          formatter: (val) => val.toFixed(2) + '%'
        },
        splitLine: { lineStyle: { color: 'rgba(42, 54, 85, 0.3)' } },
        min: 0
      },
      series: [
        {
          name: seriesItem.name || 'ç‚¹å‡»ç‡', // ä½¿ç”¨åç«¯è¿”å›çš„seriesåç§°
          type: 'bar',
          data: seriesItem.data, // ç›´æ¥ä½¿ç”¨åç«¯è¿”å›çš„seriesæ•°æ®
          itemStyle: {
            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
              { offset: 0, color: '#409eff' },
              { offset: 1, color: '#1890ff' }
            ]),
            borderRadius: 4,
            borderColor: 'rgba(255,255,255,0.1)',
            borderWidth: 0.5
          },
          label: {
            show: true,
            position: 'top',
            color: '#fff',
            fontSize: 10,
            fontWeight: 'bold',
            formatter: (p) => p.value.toFixed(2) + '%'
          },
          barWidth: '40%'
        }
      ]
    };

    // æ¸²æŸ“å›¾è¡¨
    myChart.setOption(option);
    // ç›‘å¬çª—å£resize
    window.addEventListener('resize', () => {
      if (myChart) myChart.resize();
    });

  } catch (e) {
    console.error('æ¸²æŸ“è¡Œä¸ºæŸ±çŠ¶å›¾å¤±è´¥è¯¦æƒ…ï¼š', e);
    loadingDiv.innerHTML = `
      <div class="loading" style="color: #ff4444; display: flex; align-items: center; justify-content: center; height: 400px; flex-direction: column; gap: 8px;">
        <i class="fas fa-exclamation-circle" style="font-size: 24px;"></i>
        <p>å›¾è¡¨åŠ è½½å¤±è´¥</p>
        <p style="font-size: 12px; color: #ff8888;">${e.message}</p>
      </div>
    `;
  }
}
    // æ¸²æŸ“åŸå¸‚å±‚çº§ç‚¹å‡»ç‡å›¾è¡¨
    async function renderCityLevelChart() {
      const chartContainer = document.querySelector('#cityLevelChart');
      if (!chartContainer) return;

      const loadingDiv = chartContainer.parentElement;
      loadingDiv.innerHTML = '<div id="cityLevelChartInner" class="chart-placeholder"></div>';

      try {
        const cityData = await fetchApiData('/requirement4/city');
        const chartDom = document.getElementById('cityLevelChartInner');
        if (!chartDom) return;

        const myChart = echarts.init(chartDom);

        // å·¥å…·å‡½æ•°1ï¼šæ ¼å¼åŒ–å“ç‰Œåç§°ï¼ˆå»æ‰å°æ•°ï¼Œå¦‚44923.0 â†’ 44923ï¼‰
        const formatBrandName = (name) => {
          return name.replace(/(\d+)\.0/, '$1'); // åŒ¹é…æ•°å­—+.0ï¼Œæ›¿æ¢ä¸ºçº¯æ•°å­—
        };

        // å·¥å…·å‡½æ•°2ï¼šè¿‡æ»¤æœ‰æ•°æ®çš„ç³»åˆ— + æ ¼å¼åŒ–åç§°
        const processSeries = (rawSeries) => {
          return rawSeries
            .filter(series => series.data.some(val => val > 0)) // è¿‡æ»¤ã€å…¨0æ•°æ®ã€‘çš„ç³»åˆ—
            .map(series => ({
              ...series,
              name: formatBrandName(series.name),
              data: series.data.map(val => val > 0 ? val : null) // 0å€¼æ›¿æ¢ä¸ºnullï¼ˆä¸æ¸²æŸ“ï¼‰
            }));
        };
        const processedSeries = processSeries(cityData.series);

        // å·¥å…·å‡½æ•°3ï¼šç”Ÿæˆæ›´ä¸°å¯Œçš„æ¸å˜é…è‰²ï¼ˆé¿å…é¢œè‰²é‡å¤è¿‡å¤šï¼‰
        const getSeriesColor = (index) => {
          const colorGradients = [
            [['#4caf50', '#2e7d32'], ['#8bc34a', '#558b2f']], // ç»¿è‰²ç³»
            [['#00a1ff', '#007bff'], ['#2196f3', '#1976d2']], // è“è‰²ç³»
            [['#ff9800', '#e65100'], ['#ffb74d', '#ef6c00']], // æ©™è‰²ç³»
            [['#9c27b0', '#6a1b9a'], ['#ba68c8', '#8e24aa']], // ç´«è‰²ç³»
            [['#f44336', '#b71c1c'], ['#ef5350', '#c62828']], // çº¢è‰²ç³»
            [['#795548', '#4e342e'], ['#8d6e63', '#5d4037']], // æ£•è‰²ç³»
            [['#607d8b', '#37474f'], ['#90a4ae', '#455a64']]  // ç°è‰²ç³»
          ];
          const colorPair = colorGradients.flat()[index % colorGradients.flat().length];
          return new echarts.graphic.LinearGradient(0, 0, 0, 1, [
            { offset: 0, color: colorPair[0] },
            { offset: 1, color: colorPair[1] }
          ]);
        };

        const option = {
          backgroundColor: 'transparent',
          // 1. ä¼˜åŒ–Tooltipï¼šæ›´å¤§å­—ä½“+æ¸…æ™°æ ¼å¼
          tooltip: {
            trigger: 'axis',
            axisPointer: { type: 'shadow' },
            textStyle: { color: '#fff', fontSize: 13 }, // å¢å¤§å­—ä½“
            backgroundColor: 'rgba(0, 0, 0, 0.8)', // æ›´æ·±èƒŒæ™¯ï¼Œæå‡å¯¹æ¯”åº¦
            borderColor: '#2a3655',
            borderWidth: 1,
            padding: [10, 15], // å¢å¤§å†…è¾¹è·
            formatter: function (params) {
              const currentCity = `${params[0].axisValue}çº§åŸå¸‚`;
              let tipHtml = `<div style="text-align: center; margin-bottom: 6px; font-weight: bold;">${currentCity}</div>`;
              params.forEach(item => {
                if (item.value > 0) {
                  tipHtml += `<div style="margin: 2px 0;">${item.seriesName}ï¼š<strong>${item.value}%</strong></div>`;
                }
              });
              return tipHtml;
            }
          },
          // 2. ä¼˜åŒ–å›¾ä¾‹ï¼šæ›´å¤§å­—ä½“+åˆç†é—´è·
          legend: {
            data: processedSeries.map(item => item.name),
            textStyle: { color: '#b8c2d9', fontSize: 11 }, // å¢å¤§å›¾ä¾‹å­—ä½“
            type: 'scroll',
            orient: 'horizontal',
            top: '0%',
            left: '5%',
            right: '5%',
            pageTextStyle: { color: '#b8c2d9' }, // åˆ†é¡µæŒ‰é’®æ–‡å­—é¢œè‰²
            pageIconColor: '#b8c2d9', // åˆ†é¡µæŒ‰é’®å›¾æ ‡é¢œè‰²
            pageIconInactiveColor: '#666',
            pageButtonGap: 8
          },
          grid: {
            left: '4%',
            right: '4%',
            bottom: '4%',
            top: '20%', // è¿›ä¸€æ­¥å¢å¤§é¡¶éƒ¨ç©ºé—´
            containLabel: true
          },
          xAxis: {
            type: 'category',
            data: cityData.xAxis.map(item => `${item}çº§åŸå¸‚`), // Xè½´æ˜¾ç¤ºæ›´å®Œæ•´ï¼ˆå¦‚â€œ1çº§åŸå¸‚â€ï¼‰
            axisLine: { lineStyle: { color: '#2a3655', width: 1.2 } }, // åŠ ç²—è½´çº¿
            axisLabel: { color: '#b8c2d9', fontSize: 12 }, // å¢å¤§Xè½´å­—ä½“
            axisTick: { length: 6 } // åŠ é•¿åˆ»åº¦çº¿
          },
          yAxis: {
            type: 'value',
            name: 'ç‚¹å‡»ç‡ (%)',
            nameTextStyle: { color: '#b8c2d9', fontSize: 12 }, // å¢å¤§Yè½´åç§°å­—ä½“
            axisLine: { lineStyle: { color: '#2a3655', width: 1.2 } },
            axisLabel: { color: '#b8c2d9', fontSize: 12, formatter: '{value}%' },
            splitLine: { lineStyle: { color: 'rgba(42, 54, 85, 0.4)' } }, // åŠ æ·±åˆ†å‰²çº¿
            max: 100,
            min: 0
          },
          // 3. ä¼˜åŒ–æŸ±å­ï¼šè§£å†³é‡å +å¢å¤§æ ‡ç­¾å­—ä½“
          series: processedSeries.map((item, index) => ({
            name: item.name,
            type: 'bar',
            data: item.data,
            itemStyle: {
              color: getSeriesColor(index),
              borderRadius: 6, // æ›´å¤§åœ†è§’ï¼Œæ›´ç¾è§‚
              borderColor: 'rgba(255,255,255,0.1)', // è½»å¾®æè¾¹ï¼ŒåŒºåˆ†æŸ±å­
              borderWidth: 0.5
            },
            label: {
              show: true,
              position: 'top',
              distance: 6, // å¢å¤§æ ‡ç­¾ä¸æŸ±å­çš„è·ç¦»
              formatter: (params) => params.value > 0 ? `${params.value}%` : '',
              color: '#ffffff', // æ ‡ç­¾æ”¹ä¸ºç™½è‰²ï¼Œæ›´é†’ç›®
              fontSize: 11, // å¢å¤§æ ‡ç­¾å­—ä½“
              fontWeight: 'bold'
            },
            barWidth: '5%', // è¿›ä¸€æ­¥ç¼©å°æŸ±å­å®½åº¦ï¼Œå½»åº•è§£å†³é‡å 
            barGap: '8%',    // æœ€å°åŒ–åŒåŸå¸‚å†…é—´è·
            barCategoryGap: '40%' // å¢å¤§åŸå¸‚é—´é—´è·ï¼Œæ›´èˆ’å±•
          }))
        };

        myChart.setOption(option);
        window.addEventListener('resize', () => myChart.resize());
      } catch (e) {
        console.error('æ¸²æŸ“åŸå¸‚å±‚çº§å›¾è¡¨å¤±è´¥ï¼š', e);
        loadingDiv.innerHTML = `
          <div class="loading" style="color: #ff4444;">
            <i class="fas fa-exclamation-circle"></i>
            <p>å›¾è¡¨åŠ è½½å¤±è´¥</p>
          </div>
        `;
      }
    }

    // æ¸²æŸ“æ¶ˆè´¹æ¡£æ¬¡ç‚¹å‡»ç‡å›¾è¡¨
    async function renderConsumptionLevelChart() {
      const chartContainer = document.querySelector('#consumptionLevelChart');
      if (!chartContainer) return;

      const loadingDiv = chartContainer.parentElement;
      loadingDiv.innerHTML = '<div id="consumptionLevelChartInner" class="chart-placeholder"></div>';

      try {
        const consumptionData = await fetchApiData('/consumption/level');
        const chartDom = document.getElementById('consumptionLevelChartInner');
        if (!chartDom) return;

        const myChart = echarts.init(chartDom);

        const option = {
          backgroundColor: 'transparent',
          tooltip: {
            trigger: 'axis',
            formatter: '{b}<br/>ç‚¹å‡»ç‡: {c}%',
            textStyle: { color: '#fff' }
          },
          grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
          },
          xAxis: {
            type: 'category',
            data: consumptionData.xAxis,
            axisLine: { lineStyle: { color: '#2a3655' } },
            axisLabel: { color: '#b8c2d9' }
          },
          yAxis: {
            type: 'value',
            name: 'ç‚¹å‡»ç‡ (%)',
            axisLine: { lineStyle: { color: '#2a3655' } },
            axisLabel: { color: '#b8c2d9', formatter: '{value}%' },
            splitLine: { lineStyle: { color: 'rgba(42, 54, 85, 0.3)' } }
          },
          series: [
            {
              name: 'ç‚¹å‡»ç‡',
              type: 'bar',
              data: consumptionData.series[0].data,
              itemStyle: {
                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                  { offset: 0, color: '#2196f3' },
                  { offset: 1, color: '#0d47a1' }
                ]),
                borderRadius: 4
              },
              label: {
                show: true,
                position: 'top',
                formatter: '{c}%',
                color: '#fff'
              }
            }
          ]
        };

        myChart.setOption(option);
        window.addEventListener('resize', () => myChart.resize());
      } catch (e) {
        console.error('æ¸²æŸ“æ¶ˆè´¹æ¡£æ¬¡å›¾è¡¨å¤±è´¥ï¼š', e);
        loadingDiv.innerHTML = `
          <div class="loading" style="color: #ff4444;">
            <i class="fas fa-exclamation-circle"></i>
            <p>å›¾è¡¨åŠ è½½å¤±è´¥</p>
          </div>
        `;
      }
    }

    // æ¸²æŸ“æ¶ˆè´¹æ¡£æ¬¡è½¬åŒ–ç‡å›¾è¡¨
    async function renderConsumptionConvertChart() {
      const chartContainer = document.querySelector('#consumptionConvertChart');
      if (!chartContainer) return;

      const loadingDiv = chartContainer.parentElement;
      loadingDiv.innerHTML = '<div id="consumptionConvertChartInner" class="chart-placeholder"></div>';

      try {
        const convertData = await fetchApiData('/consumption/convert');
        const chartDom = document.getElementById('consumptionConvertChartInner');
        if (!chartDom) return;

        const myChart = echarts.init(chartDom);

        const option = {
          backgroundColor: 'transparent',
          tooltip: {
            trigger: 'axis',
            textStyle: { color: '#fff' },
            formatter: function(params) {
              let result = params[0].name + '<br/>';
              params.forEach(param => {
                result += `${param.seriesName}: ${param.value}%<br/>`;
              });
              return result;
            }
          },
          legend: {
            data: convertData.series.map(item => item.name),
            textStyle: { color: '#b8c2d9' }
          },
          grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
          },
          xAxis: {
            type: 'category',
            data: convertData.xAxis,
            axisLine: { lineStyle: { color: '#2a3655' } },
            axisLabel: { color: '#b8c2d9' }
          },
          yAxis: {
            type: 'value',
            name: 'è½¬åŒ–ç‡ (%)',
            axisLine: { lineStyle: { color: '#2a3655' } },
            axisLabel: { color: '#b8c2d9', formatter: '{value}%' },
            splitLine: { lineStyle: { color: 'rgba(42, 54, 85, 0.3)' } }
          },
          series: [
            {
              name: 'ç‚¹å‡»è½¬åŒ–ç‡',
              type: 'line',
              data: convertData.series[0].data,
              smooth: true,
              lineStyle: { width: 3, color: '#9c27b0' },
              itemStyle: { color: '#9c27b0' },
              symbol: 'circle',
              symbolSize: 8
            },
            {
              name: 'è´­ä¹°è½¬åŒ–ç‡',
              type: 'line',
              data: convertData.series[1].data,
              smooth: true,
              lineStyle: { width: 3, color: '#4caf50' },
              itemStyle: { color: '#4caf50' },
              symbol: 'circle',
              symbolSize: 8
            }
          ]
        };

        myChart.setOption(option);
        window.addEventListener('resize', () => myChart.resize());
      } catch (e) {
        console.error('æ¸²æŸ“æ¶ˆè´¹æ¡£æ¬¡è½¬åŒ–ç‡å›¾è¡¨å¤±è´¥ï¼š', e);
        loadingDiv.innerHTML = `
          <div class="loading" style="color: #ff4444;">
            <i class="fas fa-exclamation-circle"></i>
            <p>å›¾è¡¨åŠ è½½å¤±è´¥</p>
          </div>
        `;
      }
    }

    // æ¸²æŸ“è´­ç‰©æ·±åº¦è¡Œä¸ºåˆ†å¸ƒå›¾è¡¨
    async function renderBehaviorChart() {
      const chartContainer = document.querySelector('#behaviorChart');
      if (!chartContainer) return;

      const loadingDiv = chartContainer.parentElement;
      loadingDiv.innerHTML = '<div id="behaviorChartInner" class="chart-placeholder"></div>';

      try {
        const behaviorData = await fetchApiData('/shoppingLevel/behavior');
        const chartDom = document.getElementById('behaviorChartInner');
        if (!chartDom) return;

        const myChart = echarts.init(chartDom);

        const option = {
          backgroundColor: 'transparent',
          tooltip: {
            trigger: 'axis',
            axisPointer: { type: 'shadow' },
            textStyle: { color: '#fff', fontSize: 12 },
            backgroundColor: 'rgba(0, 0, 0, 0.7)',
            borderColor: '#2a3655',
            borderWidth: 1,
            padding: [8, 12],
            formatter: function (params) {
              let result = `<div style="text-align: center; margin-bottom: 4px;">${params[0].axisValue}çº§åŸå¸‚</div>`;
              params.forEach(item => {
                result += `<div>${item.seriesName}ï¼š<strong>${item.value}</strong></div>`;
              });
              return result;
            }
          },
          legend: {
            data: behaviorData.series.map(item => item.name),
            textStyle: { color: '#b8c2d9' }
          },
          grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            top: '10%',
            containLabel: true
          },
          xAxis: {
            type: 'category',
            data: behaviorData.xAxis,
            axisLine: { lineStyle: { color: '#2a3655' } },
            axisLabel: { color: '#b8c2d9' }
          },
          yAxis: {
            type: 'value',
            axisLine: { lineStyle: { color: '#2a3655' } },
            axisLabel: { color: '#b8c2d9' },
            splitLine: { lineStyle: { color: 'rgba(42, 54, 85, 0.3)' } },
            max: function (value) {
              return value.max * 1.1;
            }
          },
            series: behaviorData.series.map(item => ({
            name: item.name,
            type: 'bar',
            data: item.data,
            itemStyle: { borderRadius: 4 },
            label: {
              show: true,
              position: 'top',
              distance: 5,
              color: '#b8c2d9',
              fontSize: 11,
              formatter: (params) => params.value
            },
            // ========== æ ¸å¿ƒæ”¹åŠ¨ï¼šè°ƒæ•´æŸ±å­å®½åº¦ ==========
            // æ–¹æ¡ˆ1ï¼šå›ºå®šç™¾åˆ†æ¯”ï¼ˆæ¨èï¼Œé€‚é…ä¸åŒæ•°æ®é‡ï¼‰
            barWidth: '20%', // åŸ60% â†’ æ”¹ä¸º40%ï¼ŒæŸ±å­æ›´çª„ï¼›å¯æ ¹æ®éœ€æ±‚è°ƒæ•´ä¸º30%-70%
            // æ–¹æ¡ˆ2ï¼šå›ºå®šåƒç´ å®½åº¦ï¼ˆé€‚åˆæ•°æ®é‡å›ºå®šçš„åœºæ™¯ï¼Œæ¯”å¦‚åªæœ‰5ä¸ªxè½´ç±»ç›®ï¼‰
            // barWidth: 50, // æ¯ä¸ªæŸ±å­å›ºå®š50pxå®½
            // ==========================================

            // å¯é€‰ï¼šå¤šç³»åˆ—æ—¶ï¼Œè°ƒæ•´ç³»åˆ—é—´æŸ±å­çš„é—´è·ï¼ˆé¿å…é‡å ï¼‰
            barGap: '5%', // åŒç±»ç›®ä¸‹ä¸åŒç³»åˆ—æŸ±å­çš„é—´è·ï¼ˆç™¾åˆ†æ¯”ä¸ºæŸ±å­å®½åº¦çš„æ¯”ä¾‹ï¼‰
            barCategoryGap: '30%' // ä¸åŒç±»ç›®ä¹‹é—´çš„é—´è·
          }))
        };

        myChart.setOption(option);
        window.addEventListener('resize', () => myChart.resize());
      } catch (e) {
        console.error('æ¸²æŸ“è¡Œä¸ºåˆ†å¸ƒå›¾è¡¨å¤±è´¥ï¼š', e);
        loadingDiv.innerHTML = `
          <div class="loading" style="color: #ff4444;">
            <i class="fas fa-exclamation-circle"></i>
            <p>å›¾è¡¨åŠ è½½å¤±è´¥</p>
          </div>
        `;
      }
    }

    // æ¸²æŸ“è´­ç‰©æ·±åº¦æ—¶é—´è¶‹åŠ¿å›¾è¡¨
    async function renderTrendChart() {
      const chartContainer = document.querySelector('#trendChart');
      if (!chartContainer) return;

      const loadingDiv = chartContainer.parentElement;
      loadingDiv.innerHTML = '<div id="trendChartInner" class="chart-placeholder"></div>';

      try {
        const trendData = await fetchApiData('/shoppingLevel/trend');
        const chartDom = document.getElementById('trendChartInner');
        if (!chartDom) return;

        const myChart = echarts.init(chartDom);

        const colors = ['#00a1ff', '#00ffaa', '#e91e63'];
        const option = {
          backgroundColor: 'transparent',
          // 1. ä¼˜åŒ–Tooltipï¼šæ˜¾ç¤ºæ›´æ¸…æ™°çš„è¯¦ç»†ä¿¡æ¯
          tooltip: {
            trigger: 'axis',
            textStyle: { color: '#fff', fontSize: 12 },
            backgroundColor: 'rgba(0, 0, 0, 0.7)', // åŠé€æ˜èƒŒæ™¯æ›´é†’ç›®
            borderColor: '#2a3655',
            borderWidth: 1,
            padding: [8, 12], // å†…è¾¹è·é¿å…æ–‡å­—æ‹¥æŒ¤
            axisPointer: {
              type: 'cross', // åå­—å‡†æ˜ŸæŒ‡é’ˆï¼Œç²¾å‡†å®šä½X/Yè½´
              lineStyle: { color: 'rgba(184, 194, 217, 0.5)' } // æŒ‡é’ˆæ ·å¼
            },
            // è‡ªå®šä¹‰æç¤ºæ ¼å¼ï¼šæ˜ç¡®æ˜¾ç¤ºç»´åº¦+æ•°å€¼
            formatter: function (params) {
              // å…ˆæ˜¾ç¤ºXè½´ç»´åº¦ï¼ˆæ¯”å¦‚æ—¥æœŸ/æ—¶æ®µï¼‰
              let tipHtml = `<div style="text-align: center; margin-bottom: 4px;"><strong>${params[0].axisValue}</strong></div>`;
              // éå†æ¯ä¸ªç³»åˆ—ï¼Œæ˜¾ç¤ºåç§°+å…·ä½“æ•°å€¼
              params.forEach(item => {
                // ç”¨ç³»åˆ—é¢œè‰²ä½œä¸ºå‰ç¼€ï¼Œè§†è§‰æ›´ç›´è§‚
                tipHtml += `<div style="display: flex; align-items: center; gap: 6px;">
                  <span style="width: 8px; height: 8px; background: ${item.color}; border-radius: 50%;"></span>
                  <span>${item.seriesName}ï¼š</span>
                  <span style="font-weight: bold;">${item.value}</span>
                </div>`;
              });
              return tipHtml;
            }
          },
          legend: {
            data: trendData.series.map(item => item.name),
            textStyle: { color: '#b8c2d9' },
            // å¯é€‰ï¼šå›¾ä¾‹æ‚¬æµ®é«˜äº®å¯¹åº”æŠ˜çº¿
            tooltip: { show: true },
            itemHoverStyle: { color: '#fff' } // æ‚¬æµ®æ—¶å›¾ä¾‹æ–‡å­—å˜äº®
          },
          grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            top: '10%',
            containLabel: true
          },
          xAxis: {
            type: 'category',
            data: trendData.xAxis,
            axisLine: { lineStyle: { color: '#2a3655' } },
            axisLabel: { color: '#b8c2d9' },
            // å¯é€‰ï¼šXè½´åˆ»åº¦çº¿ï¼Œè¾…åŠ©å®šä½
            axisTick: { lineStyle: { color: '#2a3655' } }
          },
          yAxis: {
            type: 'value',
            axisLine: { lineStyle: { color: '#2a3655' } },
            axisLabel: { color: '#b8c2d9' },
            splitLine: { lineStyle: { color: 'rgba(42, 54, 85, 0.3)' } },
            // å¯é€‰ï¼šYè½´åˆ»åº¦çº¿
            axisTick: { lineStyle: { color: '#2a3655' } }
          },
          series: trendData.series.map((item, index) => ({
            name: item.name,
            type: 'line',
            data: item.data,
            smooth: true,
            lineStyle: {
              width: 3,
              color: colors[index],
              // å¯é€‰ï¼šæ‚¬æµ®æ—¶æŠ˜çº¿å˜ç²—
              emphasis: { width: 5 }
            },
            itemStyle: {
              color: colors[index],
              // å¯é€‰ï¼šæ•°æ®ç‚¹æ‚¬æµ®æ—¶é«˜äº®
              emphasis: { borderColor: '#fff', borderWidth: 2 }
            },
            symbol: 'circle',
            symbolSize: 8,
            // å¯é€‰ï¼šæ•°æ®ç‚¹æ‚¬æµ®æ—¶æ”¾å¤§
            emphasis: { symbolSize: 12 },
            // 2. å¯é€‰ï¼šæ•°æ®ç‚¹æ˜¾ç¤ºæ•°å€¼æ ‡ç­¾ï¼ˆæŒ‰éœ€å¼€å¯ï¼‰
            label: {
              show: false, // é»˜è®¤ä¸ºfalseï¼Œé¿å…å›¾è¡¨æ‹¥æŒ¤ï¼›éœ€è¦æ—¶æ”¹ä¸ºtrue
              position: 'top', // æ ‡ç­¾ä½ç½®ï¼šæ•°æ®ç‚¹ä¸Šæ–¹
              color: colors[index],
              fontSize: 11,
              formatter: (params) => params.value
            },
            // 3. å¯é€‰ï¼šæŠ˜çº¿ä¸‹æ–¹å¡«å……æ¸å˜è‰²ï¼Œå¢å¼ºè§†è§‰æ•ˆæœ
            areaStyle: {
              color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                { offset: 0, color: `${colors[index]}80` }, // é¡¶éƒ¨åŠé€æ˜
                { offset: 1, color: `${colors[index]}10` }  // åº•éƒ¨æ›´é€æ˜
              ])
            }
          }))
        };

        myChart.setOption(option);
        window.addEventListener('resize', () => myChart.resize());
      } catch (e) {
        console.error('æ¸²æŸ“æ—¶é—´è¶‹åŠ¿å›¾è¡¨å¤±è´¥ï¼š', e);
        loadingDiv.innerHTML = `
          <div class="loading" style="color: #ff4444;">
            <i class="fas fa-exclamation-circle"></i>
            <p>å›¾è¡¨åŠ è½½å¤±è´¥</p>
          </div>
        `;
      }
    }

    // ========== è·¯ç”±é…ç½® ==========
    const routes = {
      '/index': {
        title: 'æ·˜å®å¹¿å‘Šç‚¹å‡»é‡å¤§æ•°æ®åˆ†æ',
        content: `
          <div class="welcome-bar">
            <div class="welcome-info">
              <div class="welcome-avatar">
                <i class="fas fa-chart-bar"></i>
              </div>
              <div class="welcome-text">
                <h3>æ·˜å®å¹¿å‘Šç‚¹å‡»é‡å¤§æ•°æ®åˆ†æç³»ç»Ÿ</h3>
                <p>å®æ—¶ç›‘æ§æ·˜å®å¹¿å‘Šç‚¹å‡»æ•°æ®ï¼Œæ·±åº¦åˆ†æç”¨æˆ·è¡Œä¸ºæ¨¡å¼<br>
                  åŸºäºå¤§æ•°æ®æŠ€æœ¯å®ç°ç²¾å‡†è¥é”€å†³ç­–æ”¯æŒ<br>
                  <span style="font-size: 14px; color: #00ffaa;">æ•°æ®æ¥æºï¼šæ·˜å®å¹¿å‘Šç³»ç»Ÿ | æ›´æ–°æ—¶é—´ï¼šå®æ—¶</span>
                </p>
              </div>
            </div>
            <div class="welcome-time">
              <div class="time-clock">00:34:05</div>
              <div class="time-date">2025å¹´12æœˆ5æ—¥ æ˜ŸæœŸäº”</div>
              <div class="time-weather">ğŸ“Š æ•°æ®è¿è¡Œæ­£å¸¸</div>
            </div>
          </div>

          <div class="data-cards">
            <div class="data-card" data-route="/requirement1">
              <div class="card-icon icon-purple">
                <i class="fas fa-clock"></i>
              </div>
              <div class="card-data">
                <h4>2.34%</h4>
                <p>å¹³å‡ç‚¹å‡»ç‡</p>
              </div>
            </div>
            <div class="data-card" data-route="/requirement2">
              <div class="card-icon icon-pink">
                <i class="fas fa-mouse-pointer"></i>
              </div>
              <div class="card-data">
                <h4>8.7M</h4>
                <p>æ—¥ç‚¹å‡»é‡</p>
              </div>
            </div>
            <div class="data-card" data-route="/requirement3">
              <div class="card-icon icon-blue">
                <i class="fas fa-users"></i>
              </div>
              <div class="card-data">
                <h4>156K</h4>
                <p>æ´»è·ƒç”¨æˆ·æ•°</p>
              </div>
            </div>
            <div class="data-card" data-route="/requirement4">
              <div class="card-icon icon-green">
                <i class="fas fa-map-marker-alt"></i>
              </div>
              <div class="card-data">
                <h4>32</h4>
                <p>è¦†ç›–åŸå¸‚æ•°</p>
              </div>
            </div>
          </div>

          <div class="dashboard-area">
            <div class="dashboard-card">
              <div class="dashboard-title">
                <i class="fas fa-chart-line"></i>
                <span>å®æ—¶ç‚¹å‡»è¶‹åŠ¿ç›‘æ§</span>
              </div>
              <div class="chart-container">
                <div style="text-align: center; color: #b8c2d9;">
                  <i class="fas fa-chart-line" style="font-size: 60px; margin-bottom: 20px; color: #00a1ff;"></i>
                  <p>å®æ—¶æ•°æ®å¯è§†åŒ–å±•ç¤º</p>
                  <p style="font-size: 14px; margin-top: 10px;">æ¯å°æ—¶æ›´æ–°ä¸€æ¬¡</p>
                </div>
              </div>
            </div>

            <div class="dashboard-card">
              <div class="dashboard-title">
                <i class="fas fa-chart-pie"></i>
                <span>ç”¨æˆ·è¡Œä¸ºåˆ†å¸ƒ</span>
              </div>
              <div class="chart-container">
                <div style="text-align: center; color: #b8c2d9;">
                  <i class="fas fa-pie-chart" style="font-size: 60px; margin-bottom: 20px; color: #00ffaa;"></i>
                  <p>ç‚¹å‡»/æœªç‚¹å‡»åˆ†å¸ƒæ¯”ä¾‹</p>
                  <p style="font-size: 14px; margin-top: 10px;">å®æ—¶ç»Ÿè®¡æ•°æ®</p>
                </div>
              </div>
            </div>
          </div>
        `
      },
      '/requirement1': {
        title: 'ç‚¹å‡»ç‡æ—¶é—´è¶‹åŠ¿åˆ†æ',
        content: `
          <div class="page-content">
            <h2 class="page-title">
              <i class="fas fa-clock"></i>
              å¹¿å‘Šç‚¹å‡»ç‡éšæ—¶é—´å˜åŒ–è¶‹åŠ¿åˆ†æ
            </h2>
            <p class="page-desc">
              åˆ†æå¹¿å‘Šç‚¹å‡»ç‡åœ¨ä¸åŒæ—¶é—´æ®µçš„åˆ†å¸ƒæƒ…å†µï¼Œè¯†åˆ«ç‚¹å‡»é«˜å³°æœŸå’Œä½è°·æœŸï¼Œä¸ºå¹¿å‘ŠæŠ•æ”¾æ—¶é—´ä¼˜åŒ–æä¾›æ•°æ®æ”¯æŒã€‚
            </p>

            <div class="detail-section">
              <div class="detail-title">ğŸ“Š æ•°æ®åˆ†ææ¦‚è§ˆ</div>
              <div class="detail-content">
                <div class="detail-item">
                  <strong>ç‰¹å¾å€¼ï¼š</strong>æ—¶é—´ã€å¹¿å‘Šç‚¹å‡»ç‡
                </div>
                <div class="detail-item">
                  <strong>æ•°æ®åº“å­—æ®µï¼š</strong>raw_sampleè¡¨ä¸­çš„time_stampï¼ˆæ—¶é—´æˆ³ï¼‰ã€clkï¼ˆç‚¹å‡»æ ‡è¯†ï¼‰
                </div>
                <div class="detail-item">
                  <strong>å¤„ç†ç®—æ³•ï¼š</strong>
                  <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>æ•°æ®åŠ è½½ï¼šspark.read.parquet("hdfs://path/to/raw_sample")</li>
                    <li>æ—¶é—´å­—æ®µè½¬æ¢ï¼šæå–å°æ—¶ï¼ˆ0-23ï¼‰</li>
                    <li>åˆ†ç»„èšåˆï¼šæŒ‰å°æ—¶åˆ†ç»„ç»Ÿè®¡å±•ç¤ºæ¬¡æ•°å’Œç‚¹å‡»æ¬¡æ•°</li>
                    <li>ç‚¹å‡»ç‡è®¡ç®—ï¼šç‚¹å‡»ç‡ = (æ€»ç‚¹å‡»æ¬¡æ•° / æ€»å±•ç¤ºæ¬¡æ•°) Ã— 100</li>
                  </ol>
                </div>
              </div>
            </div>

            <div class="dashboard-area">
              <div class="dashboard-card">
                <div class="dashboard-title">
                  <i class="fas fa-chart-line"></i>
                  <span>24å°æ—¶ç‚¹å‡»ç‡è¶‹åŠ¿</span>
                </div>
                <div class="chart-container" id="timeTrendChart">
                  <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>æ•°æ®åŠ è½½ä¸­...</p>
                  </div>
                </div>
              </div>

              <div class="dashboard-card">
                <div class="dashboard-title">
                  <i class="fas fa-table"></i>
                  <span>æ•°æ®ç»Ÿè®¡è¡¨</span>
                </div>
                <div class="chart-container">
                  <div style="width: 100%; padding: 20px;">
                    <table style="width: 100%; border-collapse: collapse; color: #b8c2d9;">
                      <thead>
                        <tr style="background: rgba(0, 161, 255, 0.1);">
                          <th style="padding: 10px; text-align: left;">æ—¶é—´æ®µ</th>
                          <th style="padding: 10px; text-align: left;">å±•ç¤ºæ¬¡æ•°</th>
                          <th style="padding: 10px; text-align: left;">ç‚¹å‡»æ¬¡æ•°</th>
                          <th style="padding: 10px; text-align: left;">ç‚¹å‡»ç‡</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr style="border-bottom: 1px solid #2a3655;">
                          <td style="padding: 10px;">00:00-01:00</td>
                          <td style="padding: 10px;">125,432</td>
                          <td style="padding: 10px;">2,891</td>
                          <td style="padding: 10px; color: #4caf50;">2.31%</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #2a3655;">
                          <td style="padding: 10px;">08:00-09:00</td>
                          <td style="padding: 10px;">245,678</td>
                          <td style="padding: 10px;">5,432</td>
                          <td style="padding: 10px; color: #00ffaa;">2.21%</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #2a3655;">
                          <td style="padding: 10px;">14:00-15:00</td>
                          <td style="padding: 10px;">356,789</td>
                          <td style="padding: 10px;">9,876</td>
                          <td style="padding: 10px; color: #00ffaa;">2.77%</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #2a3655;">
                          <td style="padding: 10px;">20:00-21:00</td>
                          <td style="padding: 10px;">298,765</td>
                          <td style="padding: 10px;">7,432</td>
                          <td style="padding: 10px; color: #4caf50;">2.49%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `,
        afterRender: renderTimeTrendChart
      },
      '/requirement2': {
        title: 'ç”¨æˆ·ç‚¹å‡»è¡Œä¸ºä¸å„ä¸ªèµ„æºä½ç‚¹å‡»ç‡åˆ†æ',
        content: `
          <div class="page-content">
            <h2 class="page-title">
              <i class="fas fa-chart-pie"></i>
             ç”¨æˆ·ç‚¹å‡»è¡Œä¸ºä¸å„ä¸ªèµ„æºä½ç‚¹å‡»ç‡åˆ†æ
            </h2>
            <p class="page-desc">
              åˆ†æç”¨æˆ·ç‚¹å‡»ä¸æœªç‚¹å‡»å¹¿å‘Šçš„æ•´ä½“åˆ†å¸ƒæƒ…å†µï¼Œäº†è§£å¹¿å‘Šçš„æ•´ä½“ç‚¹å‡»è¡¨ç°å’Œç”¨æˆ·è¡Œä¸ºç‰¹å¾ã€‚
            </p>

            <div class="detail-section">
              <div class="detail-title">ğŸ“ˆ æ•°æ®åˆ†å¸ƒåˆ†æ</div>
              <div class="detail-content">
                <div class="detail-item">
                  <strong>ç‰¹å¾å€¼ï¼š</strong>é¥¼å›¾ï¼šç‚¹å‡»ï¼Œæœªç‚¹å‡» æŸ±çŠ¶å›¾ï¼šèµ„æºä½ï¼Œç‚¹å‡»ç‡
                </div>
                <div class="detail-item">
                  <strong>æ•°æ®åº“å­—æ®µï¼š</strong>raw_sampleè¡¨ä¸­çš„clkï¼ˆç‚¹å‡»æ ‡è¯†ï¼‰ä¸pid(èµ„æºä½)
                </div>
                <div class="detail-item">
                  <strong>å¤„ç†ç®—æ³•ï¼š</strong>
                  <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>æ•´ä½“ç»Ÿè®¡ï¼šè®¡ç®—æ€»å±•ç¤ºæ¬¡æ•°å’Œæ€»ç‚¹å‡»æ¬¡æ•°</li>
                    <li>åˆ†å¸ƒè®¡ç®—ï¼šæœªç‚¹å‡»æ¬¡æ•° = æ€»å±•ç¤ºæ¬¡æ•° - æ€»ç‚¹å‡»æ¬¡æ•°</li>
                    <li>ç‚¹å‡»ç‡è®¡ç®—ï¼šå…¨å±€ç‚¹å‡»ç‡åˆ†æ</li>
                  </ol>
                </div>
              </div>
            </div>

            <div class="dashboard-area">
              <div class="dashboard-card">
                <div class="dashboard-title">
                  <i class="fas fa-pie-chart"></i>
                  <span>ç‚¹å‡»è¡Œä¸ºåˆ†å¸ƒå›¾</span>
                </div>
                <div class="chart-container" id="behaviorPieChart">
                  <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>æ•°æ®åŠ è½½ä¸­...</p>
                  </div>
                </div>
              </div>

              <div class="dashboard-card">
                <div class="dashboard-title">
                  <i class="fas fa-chart-bar"></i>
                  <span>ç”¨æˆ·è¡Œä¸ºç±»å‹åˆ†å¸ƒ</span>
                </div>
                <div class="chart-container" id="behaviorBarChart">
                  <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>æ•°æ®åŠ è½½ä¸­...</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `,
        afterRender: function() {
          renderBehaviorPieChart();
          renderBehaviorBarChart();
        }
      },
      '/requirement3': {
        title: 'æ¶ˆè´¹æ¡£æ¬¡åˆ†æ',
        content: `
          <div class="page-content">
            <h2 class="page-title">
              <i class="fas fa-money-bill-wave"></i>
              ç”¨æˆ·æ¶ˆè´¹æ¡£æ¬¡ä¸ç‚¹å‡»ç‡å…³ç³»åˆ†æ
            </h2>
            <p class="page-desc">
              åˆ†æä¸åŒæ¶ˆè´¹æ¡£æ¬¡ç”¨æˆ·çš„å¹¿å‘Šç‚¹å‡»è¡Œä¸ºå·®å¼‚ï¼Œä¸ºç²¾å‡†è¥é”€å’Œç”¨æˆ·åˆ†å±‚è¿è¥æä¾›æ•°æ®ä¾æ®ã€‚
            </p>

            <div class="detail-section">
              <div class="detail-title">ğŸ’° æ¶ˆè´¹æ¡£æ¬¡åˆ†æ</div>
              <div class="detail-content">
                <div class="detail-item">
                  <strong>ç‰¹å¾å€¼ï¼š</strong>æ¶ˆè´¹æ¡£æ¬¡ã€ç‚¹å‡»ç‡
                </div>
                <div class="detail-item">
                  <strong>æ•°æ®åº“å­—æ®µï¼š</strong>user_profileè¡¨çš„pvalue_levelã€raw_sampleè¡¨çš„clk
                </div>
                <div class="detail-item">
                  <strong>å¤„ç†ç®—æ³•ï¼š</strong>
                  <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>æ•°æ®å…³è”ï¼šuser_profileå’Œraw_sampleè¡¨è¿æ¥</li>
                    <li>åˆ†ç»„ç»Ÿè®¡ï¼šæŒ‰æ¶ˆè´¹æ¡£æ¬¡åˆ†ç»„</li>
                    <li>ç‚¹å‡»ç‡è®¡ç®—ï¼šå„æ¡£æ¬¡ç‚¹å‡»ç‡åˆ†æ</li>
                  </ol>
                </div>
              </div>
            </div>
          </div>
        `
      },
      '/requirement4': {
        title: 'åŸå¸‚å±‚çº§åå¥½åˆ†æ',
        content: `
          <div class="page-content">
            <h2 class="page-title">
              <i class="fas fa-city"></i>
              ä¸åŒåŸå¸‚å±‚çº§å¹¿å‘Šç‚¹å‡»åå¥½åˆ†æ
            </h2>
            <p class="page-desc">
              åˆ†æä¸åŒåŸå¸‚å±‚çº§ç”¨æˆ·å¯¹å¹¿å‘Šå“ç‰Œ/å“ç±»çš„ç‚¹å‡»åå¥½ï¼Œä¸ºåœ°åŸŸåŒ–å¹¿å‘ŠæŠ•æ”¾ç­–ç•¥æä¾›æ•°æ®æ”¯æŒã€‚
            </p>

            <div class="detail-section">
              <div class="detail-title">ğŸ™ï¸ åŸå¸‚å±‚çº§åˆ†æ</div>
              <div class="detail-content">
                <div class="detail-item">
                  <strong>ç‰¹å¾å€¼ï¼š</strong>åŸå¸‚å±‚çº§ã€å“ç‰Œ/å“ç±»ã€ç‚¹å‡»ç‡
                </div>
                <div class="detail-item">
                  <strong>æ•°æ®åº“å­—æ®µï¼š</strong>user_profileè¡¨çš„new_user_class_levelã€ad_featureè¡¨çš„brand/cate_id
                </div>
                <div class="detail-item">
                  <strong>å¤„ç†ç®—æ³•ï¼š</strong>
                  <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>ä¸‰è¡¨å…³è”ï¼šuser_profileã€raw_sampleã€ad_feature</li>
                    <li>åˆ†ç»„èšåˆï¼šæŒ‰åŸå¸‚å±‚çº§å’Œå“ç‰Œ/å“ç±»åˆ†ç»„</li>
                    <li>Top 3ç­›é€‰ï¼šå„åŸå¸‚å±‚çº§ç‚¹å‡»ç‡å‰ä¸‰å</li>
                  </ol>
                </div>
              </div>
            </div>

            <div class="dashboard-area">
              <div class="dashboard-card" style="grid-column: span 2;">
                <div class="dashboard-title">
                  <i class="fas fa-chart-bar"></i>
                  <span>ä¸åŒåŸå¸‚å±‚çº§ç‚¹å‡»ç‡å¯¹æ¯”</span>
                </div>
                <div class="chart-container" id="cityLevelChart">
                  <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>æ•°æ®åŠ è½½ä¸­...</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `,
        afterRender: renderCityLevelChart
      },
      '/requirement5': {
        title: 'è´­ç‰©æ·±åº¦åˆ†æ',
        content: `
          <div class="page-content">
            <h2 class="page-title">
              <i class="fas fa-shopping-cart"></i>
              è´­ç‰©æ·±åº¦ç”¨æˆ·ä»·å€¼åˆ†æ
            </h2>
            <p class="page-desc">
              åˆ†æä¸åŒè´­ç‰©æ·±åº¦ç”¨æˆ·çš„è¡Œä¸ºç‰¹å¾ã€è½¬åŒ–ç‡å’ŒLTVï¼ˆç”¨æˆ·ç”Ÿå‘½å‘¨æœŸä»·å€¼ï¼‰ï¼Œä¸ºç²¾ç»†åŒ–ç”¨æˆ·è¿è¥æä¾›å†³ç­–ä¾æ®ã€‚
            </p>

            <div class="detail-section">
              <div class="detail-title">ğŸ›’ è´­ç‰©æ·±åº¦åˆ†æ</div>
              <div class="detail-content">
                <div class="detail-item">
                  <strong>ç‰¹å¾å€¼ï¼š</strong>è´­ç‰©æ·±åº¦ã€æ´»è·ƒåº¦ã€è½¬åŒ–ç‡ã€LTV
                </div>
                <div class="detail-item">
                  <strong>æ•°æ®åº“å­—æ®µï¼š</strong>user_profileè¡¨çš„shopping_levelã€behavior_logè¡¨çš„btag
                </div>
                <div class="detail-item">
                  <strong>å¤„ç†ç®—æ³•ï¼š</strong>
                  <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>ä¸‰è¡¨å…³è”ï¼šuser_profileã€behavior_logã€raw_sample</li>
                    <li>æŒ‡æ ‡è®¡ç®—ï¼šæ´»è·ƒåº¦ã€è½¬åŒ–ç‡ã€LTVç­‰å…³é”®æŒ‡æ ‡</li>
                    <li>åˆ†å±‚åˆ†æï¼šæŒ‰è´­ç‰©æ·±åº¦è¿›è¡Œç”¨æˆ·åˆ†å±‚</li>
                  </ol>
                </div>
              </div>
            </div>
          </div>
        `
      },
      '/consumption/level': {
        title: 'æ¶ˆè´¹æ¡£æ¬¡-ç‚¹å‡»åˆ†æ',
        content: `
          <div class="page-content">
            <h2 class="page-title">
              <i class="fas fa-list"></i>
              æ¶ˆè´¹æ¡£æ¬¡-ç‚¹å‡»ç‡åˆ†æ
            </h2>
            <p class="page-desc">
              åˆ†æä¸åŒæ¶ˆè´¹æ¡£æ¬¡ç”¨æˆ·çš„å¹¿å‘Šç‚¹å‡»ç‡å·®å¼‚ï¼Œä¸ºç²¾å‡†è¥é”€å’Œç”¨æˆ·åˆ†å±‚è¿è¥æä¾›æ•°æ®ä¾æ®ã€‚
            </p>

            <div class="detail-section">
              <div class="detail-title">ğŸ“Š æ•°æ®è¯´æ˜</div>
              <div class="detail-content">
                <div class="detail-item">
                  <strong>æ•°æ®æ¥æºï¼š</strong>åç«¯æ¥å£ /api/consumption/level
                </div>
                <div class="detail-item">
                  <strong>ç»Ÿè®¡ç»´åº¦ï¼š</strong>æŒ‰æ¶ˆè´¹æ¡£æ¬¡åˆ†å±‚ï¼Œç»Ÿè®¡å„æ¡£æ¬¡çš„å¹¿å‘Šç‚¹å‡»ç‡
                </div>
                <div class="detail-item">
                  <strong>æ ¸å¿ƒç»“è®ºï¼š</strong>æ¶ˆè´¹æ¡£æ¬¡è¶Šé«˜ï¼Œå¹¿å‘Šç‚¹å‡»ç‡è¶Šé«˜
                </div>
              </div>
            </div>

            <div class="dashboard-area">
              <div class="dashboard-card" style="grid-column: span 2;">
                <div class="dashboard-title">
                  <i class="fas fa-chart-bar"></i>
                  <span>ä¸åŒæ¶ˆè´¹æ¡£æ¬¡ç‚¹å‡»ç‡å¯¹æ¯”</span>
                </div>
                <div class="chart-container" id="consumptionLevelChart">
                  <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>æ•°æ®åŠ è½½ä¸­...</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `,
        afterRender: renderConsumptionLevelChart
      },

      '/shoppingLevel/behavior': {
        title: 'è´­ç‰©æ·±åº¦-è¡Œä¸ºåˆ†å¸ƒ',
        content: `
          <div class="page-content">
            <h2 class="page-title">
              <i class="fas fa-list"></i>
              è´­ç‰©æ·±åº¦-ç”¨æˆ·è¡Œä¸ºåˆ†å¸ƒåˆ†æ
            </h2>
            <p class="page-desc">
              åˆ†æä¸åŒè´­ç‰©æ·±åº¦ç”¨æˆ·çš„è¡Œä¸ºåˆ†å¸ƒï¼ˆæµè§ˆã€æ”¶è—ã€åŠ è´­ã€è´­ä¹°ï¼‰ï¼Œè¯†åˆ«é«˜ä»·å€¼ç”¨æˆ·çš„è¡Œä¸ºç‰¹å¾ã€‚
            </p>

            <div class="detail-section">
              <div class="detail-title">ğŸ“Š æ•°æ®è¯´æ˜</div>
              <div class="detail-content">
                <div class="detail-item">
                  <strong>æ•°æ®æ¥æºï¼š</strong>åç«¯æ¥å£ /api/shoppingLevel/behavior
                </div>
                <div class="detail-item">
                  <strong>ç»Ÿè®¡ç»´åº¦ï¼š</strong>æŒ‰è´­ç‰©æ·±åº¦åˆ†å±‚ï¼Œç»Ÿè®¡å„è¡Œä¸ºç±»å‹çš„ç”¨æˆ·æ•°
                </div>
                <div class="detail-item">
                  <strong>æ ¸å¿ƒç»“è®ºï¼š</strong>è´­ç‰©æ·±åº¦è¶Šé«˜ï¼Œè´­ä¹°è½¬åŒ–è¡Œä¸ºå æ¯”è¶Šé«˜
                </div>
              </div>
            </div>

            <div class="dashboard-area">
              <div class="dashboard-card" style="grid-column: span 2;">
                <div class="dashboard-title">
                  <i class="fas fa-chart-bar"></i>
                  <span>ä¸åŒè´­ç‰©æ·±åº¦ç”¨æˆ·è¡Œä¸ºåˆ†å¸ƒ</span>
                </div>
                <div class="chart-container" id="behaviorChart">
                  <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>æ•°æ®åŠ è½½ä¸­...</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `,
        afterRender: renderBehaviorChart
      },
      '/shoppingLevel/trend': {
        title: 'è´­ç‰©æ·±åº¦-æ—¶é—´è¶‹åŠ¿',
        content: `
          <div class="page-content">
            <h2 class="page-title">
              <i class="fas fa-chart-line"></i>
              è´­ç‰©æ·±åº¦-ç”¨æˆ·æ´»è·ƒæ—¶é—´è¶‹åŠ¿
            </h2>
            <p class="page-desc">
              åˆ†æä¸åŒè´­ç‰©æ·±åº¦ç”¨æˆ·åœ¨ä¸€å¤©å†…çš„æ´»è·ƒæ—¶é—´è¶‹åŠ¿ï¼Œä¸ºåˆ†æ—¶æ®µç²¾å‡†è¥é”€æä¾›æ•°æ®æ”¯æŒã€‚
            </p>

            <div class="detail-section">
              <div class="detail-title">ğŸ“ˆ æ•°æ®è¯´æ˜</div>
              <div class="detail-content">
                <div class="detail-item">
                  <strong>æ•°æ®æ¥æºï¼š</strong>åç«¯æ¥å£ /api/shoppingLevel/trend
                </div>
                <div class="detail-item">
                  <strong>ç»Ÿè®¡ç»´åº¦ï¼š</strong>æŒ‰å°æ—¶ç»Ÿè®¡ä¸åŒè´­ç‰©æ·±åº¦ç”¨æˆ·çš„æ´»è·ƒæ¬¡æ•°
                </div>
                <div class="detail-item">
                  <strong>æ ¸å¿ƒç»“è®ºï¼š</strong>é«˜è´­ç‰©æ·±åº¦ç”¨æˆ·åœ¨16:00-20:00æ´»è·ƒåº¦æœ€é«˜
                </div>
              </div>
            </div>

            <div class="dashboard-area">
              <div class="dashboard-card" style="grid-column: span 2;">
                <div class="dashboard-title">
                  <i class="fas fa-chart-line"></i>
                  <span>ä¸åŒè´­ç‰©æ·±åº¦ç”¨æˆ·æ´»è·ƒæ—¶é—´è¶‹åŠ¿</span>
                </div>
                <div class="chart-container" id="trendChart">
                  <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>æ•°æ®åŠ è½½ä¸­...</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `,
        afterRender: renderTrendChart
      },
      '/detail': {
        title: 'è¯¦æƒ…åˆ†ææŠ¥å‘Š',
        content: `
          <div class="page-content">
            <h2 class="page-title">
              <i class="fas fa-file-alt"></i>
              å¹¿å‘Šæ•°æ®åˆ†æè¯¦æƒ…æŠ¥å‘Š
            </h2>
            <p class="page-desc">
              æœ¬æŠ¥å‘ŠåŸºäºæ·˜å®å¹¿å‘Šç‚¹å‡»å¤§æ•°æ®ï¼Œä»äº”ä¸ªç»´åº¦æ·±åº¦åˆ†æç”¨æˆ·è¡Œä¸ºç‰¹å¾å’Œå¹¿å‘Šè¡¨ç°ï¼Œä¸ºè¥é”€å†³ç­–æä¾›å…¨é¢æ•°æ®æ”¯æŒã€‚
            </p>

            <div class="detail-section">
              <div class="detail-title">ğŸ“‹ åˆ†æé¡¹ç›®æ¦‚è§ˆ</div>
              <div class="detail-content">
                <div class="detail-item">
                  <strong>1. æ—¶é—´è¶‹åŠ¿åˆ†æï¼š</strong>è¯†åˆ«å¹¿å‘Šç‚¹å‡»çš„é«˜å³°æœŸå’Œä½è°·æœŸï¼Œä¼˜åŒ–æŠ•æ”¾æ—¶é—´ç­–ç•¥
                </div>
                <div class="detail-item">
                  <strong>2. è¡Œä¸ºåˆ†å¸ƒåˆ†æï¼š</strong>äº†è§£æ•´ä½“ç‚¹å‡»ç‡è¡¨ç°ï¼Œè¯„ä¼°å¹¿å‘Šæ•ˆæœ
                </div>
                <div class="detail-item">
                  <strong>3. æ¶ˆè´¹æ¡£æ¬¡åˆ†æï¼š</strong>è¯†åˆ«ä¸åŒæ¶ˆè´¹èƒ½åŠ›ç”¨æˆ·çš„ç‚¹å‡»åå¥½
                </div>
                <div class="detail-item">
                  <strong>4. åŸå¸‚å±‚çº§åˆ†æï¼š</strong>åˆ†æåœ°åŸŸå·®å¼‚å¯¹å¹¿å‘Šæ•ˆæœçš„å½±å“
                </div>
                <div class="detail-item">
                  <strong>5. è´­ç‰©æ·±åº¦åˆ†æï¼š</strong>è¯„ä¼°ä¸åŒç”¨æˆ·ç¾¤ä½“çš„é•¿æœŸä»·å€¼
                </div>
              </div>
            </div>

            <div class="detail-section">
              <div class="detail-title">ğŸ¯ å…³é”®å‘ç°</div>
              <div class="detail-content">
                <div class="detail-item">
                  <strong>æœ€ä½³æŠ•æ”¾æ—¶é—´ï¼š</strong>14:00-16:00ä¸ºç‚¹å‡»é«˜å³°æœŸï¼Œç‚¹å‡»ç‡è¾¾2.77%
                </div>
                <div class="detail-item">
                  <strong>é«˜ä»·å€¼ç”¨æˆ·ç¾¤ä½“ï¼š</strong>æ¶ˆè´¹æ¡£æ¬¡é«˜çš„ç”¨æˆ·ç‚¹å‡»ç‡æ˜¾è‘—é«˜äºæ™®é€šç”¨æˆ·
                </div>
                <div class="detail-item">
                  <strong>åœ°åŸŸå·®å¼‚ï¼š</strong>ä¸€çº¿åŸå¸‚ç”¨æˆ·å¯¹å“ç‰Œå¹¿å‘Šæ¥å—åº¦æ›´é«˜
                </div>
                <div class="detail-item">
                  <strong>æ·±åº¦ç”¨æˆ·ä»·å€¼ï¼š</strong>è´­ç‰©æ·±åº¦3çº§ç”¨æˆ·çš„LTVæ˜¯æµ…å±‚ç”¨æˆ·çš„3å€
                </div>
              </div>
            </div>

            <div class="detail-section">
              <div class="detail-title">ğŸ’¡ ä¼˜åŒ–å»ºè®®</div>
              <div class="detail-content">
                <div class="detail-item">
                  1. åœ¨14:00-16:00é«˜å³°æœŸå¢åŠ å¹¿å‘ŠæŠ•æ”¾é¢„ç®—
                </div>
                <div class="detail-item">
                  2. é’ˆå¯¹é«˜æ¶ˆè´¹æ¡£æ¬¡ç”¨æˆ·è®¾è®¡ä¸“å±å¹¿å‘Šå†…å®¹
                </div>
                <div class="detail-item">
                  3. æ ¹æ®ä¸åŒåŸå¸‚å±‚çº§è°ƒæ•´å¹¿å‘Šç­–ç•¥å’Œå†…å®¹
                </div>
                <div class="detail-item">
                  4. é‡ç‚¹ç»´æŠ¤è´­ç‰©æ·±åº¦3çº§çš„é«˜ä»·å€¼ç”¨æˆ·
                </div>
              </div>
            </div>
          </div>
        `
      }
    };

    // ========== æ ¸å¿ƒä¿®å¤4ï¼šèœå•æŠ˜å åŠŸèƒ½ä¼˜åŒ– ==========
    const shoppingLevelParent = document.getElementById('shoppingLevelParent');
    const shoppingLevelSubmenu = document.getElementById('shoppingLevelSubmenu');
    let isShoppingSubmenuOpen = false;
    shoppingLevelParent.classList.add('collapsed');

    shoppingLevelParent.addEventListener('click', function(e) {
      e.stopPropagation();
      isShoppingSubmenuOpen = !isShoppingSubmenuOpen;
      if (isShoppingSubmenuOpen) {
        shoppingLevelSubmenu.classList.add('show');
        shoppingLevelParent.classList.remove('collapsed');
      } else {
        shoppingLevelSubmenu.classList.remove('show');
        shoppingLevelParent.classList.add('collapsed');
      }
    });

    // æ¶ˆè´¹æ¡£æ¬¡æŠ˜å èœå•
    const consumptionParent = document.getElementById('consumptionParent');
    const consumptionSubmenu = document.getElementById('consumptionSubmenu');
    let isConsumptionSubmenuOpen = false;
    consumptionParent.classList.add('collapsed');

    consumptionParent.addEventListener('click', function(e) {
      e.stopPropagation();
      isConsumptionSubmenuOpen = !isConsumptionSubmenuOpen;
      if (isConsumptionSubmenuOpen) {
        consumptionSubmenu.classList.add('show');
        consumptionParent.classList.remove('collapsed');
      } else {
        consumptionSubmenu.classList.remove('show');
        consumptionParent.classList.add('collapsed');
      }
    });

    // ========== æ ¸å¿ƒä¿®å¤5ï¼šè·¯ç”±é€»è¾‘å¢å¼º ==========
    const contentWrapper = document.getElementById('contentWrapper');
    const currentPageTitle = document.getElementById('currentPageTitle');
    const menuItems = document.querySelectorAll('.menu-item[data-route]');
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebar = document.querySelector('.sidebar');

    // åˆ‡æ¢è·¯ç”±çš„æ ¸å¿ƒå‡½æ•°
    function navigateTo(route) {
      if (!routes[route]) route = '/index';

      window.location.hash = route;
      contentWrapper.innerHTML = routes[route].content;
      currentPageTitle.textContent = routes[route].title;

      // æ›´æ–°èœå•æ¿€æ´»çŠ¶æ€
      menuItems.forEach(item => {
        item.classList.remove('active');
        if (item.dataset.route === route) {
          item.classList.add('active');
          // è‡ªåŠ¨å±•å¼€å¯¹åº”å­èœå•
          if (route.startsWith('/shoppingLevel')) {
            isShoppingSubmenuOpen = true;
            shoppingLevelSubmenu.classList.add('show');
            shoppingLevelParent.classList.remove('collapsed');
          } else if (route.startsWith('/consumption')) {
            isConsumptionSubmenuOpen = true;
            consumptionSubmenu.classList.add('show');
            consumptionParent.classList.remove('collapsed');
          }
        }
      });

      // å»¶è¿Ÿæ‰§è¡Œæ¸²æŸ“ï¼Œç¡®ä¿DOMå®Œå…¨åŠ è½½
      if (routes[route].afterRender) {
        setTimeout(() => {
          try {
            routes[route].afterRender();
          } catch (error) {
            console.error('æ¸²æŸ“å›¾è¡¨æ—¶å‡ºé”™:', error);
          }
        }, 300);
      }

      bindContentRoutes();
      updateTime();
    }

    // ä¸ºå†…å®¹ä¸­çš„å¯ç‚¹å‡»å…ƒç´ ç»‘å®šè·¯ç”±
    function bindContentRoutes() {
      const contentItems = contentWrapper.querySelectorAll('[data-route]');
      contentItems.forEach(item => {
        item.addEventListener('click', function () {
          navigateTo(this.dataset.route);
        });
      });
    }

    // ç›‘å¬Hashå˜åŒ–
    window.addEventListener('hashchange', function () {
      const currentRoute = window.location.hash.slice(1) || '/index';
      navigateTo(currentRoute);
    });

    // èœå•ç‚¹å‡»äº‹ä»¶
    menuItems.forEach(item => {
      item.addEventListener('click', function () {
        navigateTo(this.dataset.route);
      });
    });

    // ä¾§è¾¹æ æ”¶ç¼©/å±•å¼€
    sidebarToggle.addEventListener('click', function () {
      sidebar.style.width = sidebar.style.width === '60px' ? '200px' : '60px';
    });

    // é¡µé¢åˆå§‹åŒ–
    window.addEventListener('load', function () {
      const initialRoute = window.location.hash.slice(1) || '/index';
      navigateTo(initialRoute);
      bindContentRoutes();
    });
  </script>
</body>
</html>